---
import { getCollection } from "astro:content";
import Default from "@/layouts/Default.astro";
import ContentHeader from "@/components/layout/ContentHeader.astro";
import WritingCard from "./_components/WritingCard.astro";
import { formateDate, sortPosts, type Post } from "@/lib/utils";

const posts: Post[] = await getCollection("writing");
const sortedPosts = sortPosts(posts);
let layoutProps = {
  title: "writing",
  description: "Writing about programming and other things",
  enableProse: false,
};
---

<Default {...layoutProps}>
  <ContentHeader slot="header" title="Writing">
    Some of my notes and thoughts, <a href="/feed.xml" target="_blank"
      >RSS feed</a
    >.
  </ContentHeader>

  <ul class="mt-5 flex flex-col gap-6">
    {
      sortedPosts.map((post: Post) => {
        const { title, date, description } = post.data;

        const isoStringDate = date ? date.toISOString() : null;
        const formattedDate = date ? formateDate(date) : "Date not available";

        return (
          <WritingCard
            title={title}
            description={description}
            slug={post.slug}
            isoStringDate={isoStringDate}
            formattedDate={formattedDate}
          />
        );
      })
    }
  </ul>
</Default>
